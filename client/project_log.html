<!doctype html>

<script type='text/javascript'>


var project={};

//Open text editor...
project.edit=function(el){
	project.ed.text(el, function(){
		project.update(project.ed.row(), project.ed.rowid(), true); 
		project.ed.hide();
	});
};

project.make_current=function(el){
	var pid=$(el).text();
	$("#browser_tab").text("CASBAH ("+pid+")");
	localStorage.setItem("project_id", pid);
};

project.update=function(row, rowid, flag){
	console.log("Project update ROW:",row," ROWID:", rowid);
	//TODO...
};

project.refresh=function(){
	$.ajax({
		contentType: "application/x-www-form-urlencoded; charset=UTF-8",
		data: $.param({action:"PROJECT-SELECT"}),
		error: function(err){ console.log("Error", err);},
		success: function(result){
			//casbah.renderFX("project-content", project.content, result, delta);
			$("#project-placeholder").html(project.template(result));
		},
		type:"POST",
		url:"/uploads"
	});
};

//Menu action
project.current=function(){
	var caller=project.menu.menu("option","caller");
	var pid=$(caller).closest("[project_id]").attr("project_id");
	$("#browser_tab").text("CASBAH-"+pid);
	localStorage.setItem("project_id", pid);
};

// text editor
project.ed=new casbah.Editor();

// highligher
//project.hi=new casbah.Highlighter("highlite");

// initialize context menu...
project.menu=$("#project-menu").menu().css("position","absolute", "width", "200px").hide();

//load templates and render...
$.get("client/header.html", function(htm){
	//beware - this is asynchronous so risk of project.header being undefined if called outside this function
	project.header_template=Handlebars.compile(htm);
	$("#project-header-placeholder").html(project.header_template({doc_type:"Project Log"}));
});



project.template=Handlebars.compile($("#project-template").html());
project.refresh();

</script>
</head>
<body>

<!-- PAGE -->

<div class="container">
	<div id="project-header-placeholder">placeholder</div>
	<div id="project-placeholder">placeholder</div>
	<br><br><br><br>
</div>


<template id="project-template" type="text/x-handlebars-template">
	<div class="row marz row__"></div>

	{{#each projects}}
	
	<div class="row marz row zebra" >
	<small class="col-xs-1 row-head marz">{{plusOne @index}}</small>
	<div class="border-left col-xs-11 marz" >
	<span class="col-xs-2 row-head marz">Project No.</span>
	<span class="col-xs-3 row-head marz">Project</span>
	<span class="col-xs-2 row-head marz">Owner</span>
	<span class="col-xs-2 row-head marz">Date</span>
	<span class="col-xs-2 row-head marz">GC</span>
	</div>	
	</div>	
	
	<div class="row marz"
		project_id="{{dir}}"
		oncontextmenu="casbah.showMenu(project.menu, event)">
	<p 	class="col-xs-1 marz"></p>		
	<div class="border-left col-xs-11 marz" >
	<p 	class="col-xs-2 marz"
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		title="Click to make current"
		field="project_id"
		rowid="{{rowid}}"
		onclick="project.make_current(this);">{{project_id}}</p>
		
	<p 	class="col-xs-3 marz"
		field="project_name"
		title="Click to edit"		
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{project_name}}</p>
	
	<p 	class="col-xs-2 marz"
		field="client"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{owner}}</p>
	<p 	class="col-xs-2 marz"
		field="date"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{date}}</p>
		
	<p 	class="col-xs-2 marz"
		field="contractor"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{contractor}}</p>
	</div>	
	</div>
	
	<div class="row marz">
	<p class="col-xs-1 row-head marz">&nbsp;</p>
	<div class="border-left col-xs-11 marz" >
	
	<p class="col-xs-2 row-head marz">Permit</p>
	<p class="col-xs-3 row-head marz">Address</p>
	<p class="col-xs-2 row-head marz">Status</p>
	<p class="col-xs-2 row-head marz">Date Done</p>
	<p class="col-xs-2 row-head marz">xdata</p>
	</div>	
	</div>
	
	<div class="row marz"
		project_id="{{dir}}"
		oncontextmenu="casbah.showMenu(project.menu, event)">

	<p class="col-xs-1 marz ">&nbsp;</p>
	<div class="border-left marz col-xs-11">
	<p 	class="col-xs-2 marz"
		field="permit"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{permit}}</p>	
			
	<p 	class="col-xs-3 marz"
		field="address"
		title="Click to edit"
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{address}}</p>
		
	<p 	class="col-xs-2 marz"
		field="date_closed"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{date_closed}}</p>
		
	<p 	class="col-xs-2 marz"
		field="status"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{status}}</p>
		
	<p 	class="col-xs-2 marz"
		field="xdata"
		title="Click to edit"	
		onmouseenter="$(this).addClass('highlight')"
		onmouseleave="$(this).removeClass('highlight')"
		onclick="project.edit(this);">{{xdata}}</p>
	</div>		
	</div>
	{{/each}}	
</template>


<!-- MENUS -->
<ul id="project-menu" onmouseleave="project.menu.hide()" class="hide9999">
<li class="disabled" onclick="alert('Add...');">Add</li>
<li onclick="project.current();">Current</li>
<li onclick="project.menu.hide();project.refresh();">Refresh</li>
<li onclick="project.menu.hide()">Exit</li>
</ul >


